{% load settings %}
{% load i18n %}
{% load integers %}
{% load voting %}

<div class="row search-result-item {% if item.owner == request.user %}owners-result-item{% endif %}" id="{{ item.pk|num_encode }}">
    <div class="col-md-1 col-sm-4 search-result-social text-center">
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <a href="{% url 'Search:vote' %}?type=upvote&srpk={{ item.pk|num_encode }}" class="btn btn-success vote-link" {% if not item|can_vote:request.user %}disabled="disabled"{% endif %}>
                    <i class="glyphicon glyphicon-chevron-up"></i>
                </a>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 col-sm-12">
                <a href="{% url 'Search:vote' %}?type=downvote&srpk={{ item.pk|num_encode }}" class="btn btn-danger vote-link" {% if not item|can_vote:request.user %}disabled="disabled"{% endif %}>
                    <i class="glyphicon glyphicon-chevron-down"></i>
                </a>
            </div>
        </div>

        <div class="row margin-top">
            <div class="col-md-12 col-sm-12" id="scores-{{ item.pk|num_encode }}">
                {% include 'Search/includes/scores.html' with item=item %}
            </div>
        </div>
    </div>

    <div class="col-md-3 col-sm-8">
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <h4>
                    {% settings_context "LINKS_NEW_WINDOW" as LINKS_NEW_WINDOW %}
                    <a href="{{ item.link }}" data-href="{% url 'Search:open' url=item.link|urlencode %}" onmousedown="makeHref($(this));"
                       {% if LINKS_NEW_WINDOW == True %}target="_blank"{% endif %}>
                        {% if LINKS_NEW_WINDOW == True %}
                            <i class="glyphicon glyphicon-new-window new-window-icon"></i>
                        {% endif %}
                        {{ item }}
                    </a>
                </h4>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 col-sm-12">
                {% trans 'Found in:' %} <span class="text-info">{{ item.formatted_url }}</span>
            </div>
        </div>

        <div class="row margin-top">
            <div class="col-md-12 col-sm-12">
                <div class="btn-group" role="group">
                    <a href="#" class="btn btn-info">View</a>
                    {% if item.owner == request.user %}
                        <a href="{% url 'Search:purchase' %}?method=sell&srpk={{ item.pk|num_encode }}" class="btn btn-info purchase-btn">{% trans 'Sell' %}</a>
                    {% else %}
                        <a href="{% url 'Search:purchase' %}?method=buy&srpk={{ item.pk|num_encode }}" class="btn btn-info purchase-btn">{% trans 'Buy' %}</a>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4 col-sm-12 search-result-snippet">
        <p>{{ item.html_snippet|safe }}</p>
    </div>

    <div class="col-md-4 col-sm-12">
        <div class="row">
            <div class="col-md-12 col-sm-12">
                <h3>{% trans "Comments" %}</h3>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12 col-sm-12" id="comment-list-{{ item.pk|num_encode }}">
                {% include 'Search/includes/comment_list.html' with item=item %}
            </div>
        </div>

        {% if request.user.is_authenticated %}

            <div class="row">
                <div class="col-md-12 col-sm-12">
                    <a class="fake-btn comment-add" data-toggle="collapse" data-target="#collapsed-comment-{{ item.pk|num_encode }}" aria-expanded="false" aria-controls="collapsed-comment-{{ item.pk|num_encode }}">
                        <i class="glyphicon glyphicon-plus"></i> {% trans "Add Comment" %}
                    </a>
                </div>
            </div>

            <div class="row collapse" id="collapsed-comment-{{ item.pk|num_encode }}">
                <div class="col-md-12 col-sm-12">
                    <form action="{% url 'Search:add_comment' %}" method="post" class="comment-form" onsubmit="return commentFormSubmit($(this));">
                        {% csrf_token %}
                        {{ comment_form }}

                        <input type="hidden" name="srpk" value="{{ item.pk|num_encode }}" />
                        <input type="submit" class="btn btn-success" value="{% trans "Comment" %}" />
                    </form>
                </div>
            </div>

        {% endif %}
    </div>
</div>